📋 프롬프트 입력용: ThreadPilot 개발 명세서 (Python)
[지시 사항]
당신은 시니어 파이썬 백엔드 개발자이자 시스템 아키텍트입니다.
아래의 기획 의도와 기술 요구사항을 바탕으로 **"ThreadPilot"**이라는 프로젝트 운영 자동화 시스템의 핵심 MVP(Minimum Viable Product)를 구축해야 합니다.

이 시스템은 단순한 코딩 도구가 아니라, **"프로젝트 상태(State)를 관리하는 운영 엔진"**입니다.

1. 프로젝트 개요
프로젝트명: ThreadPilot (Core Engine)

핵심 철학: "코드를 분석하는 것이 아니라, 프로젝트의 흐름(Context)을 분석하고 동기화한다."

주요 기능:

Context Ingestion: 이메일, 요구사항 문서, Git 커밋 로그를 수집하여 프로젝트 맥락 이해.

Review Packet Generation: PR 발생 시 단순 코드 리뷰가 아닌 '요구사항 충족 여부', '스펙 드리프트', '리스크'를 분석한 패킷 생성.

State Synchronization: 코드 변경 사항에 맞춰 TODO 리스트와 요구사항 문서를 자동으로 최신화.

타겟 환경: Local Execution (On-premise friendly), Python 3.10+

2. 기술 스택 (Requirements)
Language: Python 3.10+

Framework: FastAPI (API 서버 및 MCP 서버 확장을 위해)

Data Models: Pydantic (엄격한 타입 검증)

LLM Interface: LiteLLM (OpenAI, Anthropic, Ollama 등 로컬 모델 교체 용이성 확보)

Vector DB (Memory): ChromaDB (프로젝트 맥락 검색용)

Git Integration: GitPython

Workflow Orchestration: LangGraph (상태 기반 에이전트 흐름 제어)

3. 시스템 아키텍처 및 디렉토리 구조
프로젝트는 모듈화된 구조를 가져야 합니다.

Plaintext
threadpilot/
├── src/
│   ├── api/                 # 외부 연동 인터페이스 (API, MCP)
│   ├── core/
│   │   ├── engine.py        # 메인 워크플로우 엔진 (LangGraph)
│   │   ├── state_manager.py # 프로젝트 상태 관리 (Project State)
│   │   └── memory.py        # RAG 및 히스토리 관리 (ChromaDB)
│   ├── agents/              # 전문 AI 에이전트 모음
│   │   ├── requirements.py  # 요구사항 분석가
│   │   ├── reviewer.py      # Review Packet 생성기
│   │   └── syncer.py        # 문서/TODO 동기화 담당
│   ├── integrations/        # 외부 도구 연동
│   │   ├── git_client.py
│   │   └── mail_parser.py
│   └── models/              # Pydantic 데이터 모델
│       ├── schema.py
│       └── packet.py
├── data/                    # 로컬 DB 및 저장소
├── config.py
└── main.py
4. 핵심 데이터 모델 (Pydantic Schema)
이 데이터 구조를 기반으로 구현하십시오.

A. ProjectState (프로젝트 상태)
Python
class ProjectStatus(str, Enum):
    PLANNING = "planning"
    IN_PROGRESS = "in_progress"
    TESTING = "testing"
    RELEASE_READY = "release_ready"

class FeatureReq(BaseModel):
    id: str
    description: str
    status: str  # pending, implemented, verified
    linked_files: List[str] = []

class ProjectState(BaseModel):
    project_id: str
    current_phase: ProjectStatus
    requirements: List[FeatureReq]
    active_todos: List[str]
    risk_level: str  # low, medium, high
    last_updated: datetime
B. ReviewPacket (리뷰 패킷 - 핵심 차별화)
단순한 코드 리뷰 텍스트가 아닙니다.

Python
class DriftAnalysis(BaseModel):
    is_drift_detected: bool
    original_spec: str
    current_impl: str
    reason: str

class ReviewPacket(BaseModel):
    pr_id: str
    # 1. 요구사항 충족 분석
    fulfilled_requirements: List[str]
    missing_requirements: List[str]
    
    # 2. 스펙 드리프트 감지 (원래 의도와 달라진 점)
    drift_analysis: DriftAnalysis
    
    # 3. 프로젝트 영향도
    impacted_modules: List[str]
    new_todos_created: List[str]
    
    # 4. 운영 제안
    suggested_actions: List[str]  # 예: "문서 업데이트 필요", "보안 팀 검토 필요"
5. 주요 구현 모듈 명세
Module 1: The Project Engine (LangGraph 기반)
역할: 들어오는 입력(Email, Commit, User Command)을 분류하고 적절한 Sub-Agent에게 라우팅합니다.

Workflow:

Input 수신

Intent Classification (요구사항 추가 vs 버그 리포트 vs 단순 문의)

State 로드 (ChromaDB에서 관련 맥락 검색)

Agent 실행

State 업데이트 및 저장

Module 2: Review Packet Generator (agents/reviewer.py)
입력: Git Diff, Related Requirements (from DB)

프롬프트 전략:

단순히 "코드가 좋은가?"를 묻지 않는다.

**"이 변경사항(Diff)이 저장된 요구사항(Requirement X)을 완벽히 구현했는가? 누락된 엣지 케이스는 무엇인가? 이로 인해 업데이트해야 할 문서는 무엇인가?"**를 추론하도록 지시.

출력: ReviewPacket JSON 객체

Module 3: State Syncer (agents/syncer.py)
역할: 코드가 변경되면 문서를 자동으로 고칩니다.

로직:

ReviewPacket에서 "구현 완료" 판정이 나면 -> requirements.json의 해당 항목을 implemented로 변경.

코드에 TODO 주석이 추가되면 -> 중앙 todo_list.md에 자동 추가.

함수 시그니처가 바뀌면 -> API 문서를 갱신할 초안(Draft) 생성.

6. 개발 단계별 가이드 (Step-by-Step Implementation)
Step 1: 기본 인프라 셋업

LiteLLM을 사용하여 OpenAI/Anthropic API 키를 연동하는 LLMClient 클래스를 만드세요.

Pydantic 모델(ProjectState, ReviewPacket)을 정의하세요.

Step 2: Git 연동 및 Context 수집기

GitPython을 사용하여 현재 저장소의 최근 커밋과 Diff를 가져오는 함수를 작성하세요.

이 정보를 LLM에게 전달하기 좋게 텍스트로 요약하는 전처리기를 만드세요.

Step 3: Review Packet 에이전트 구현 (핵심)

가짜(Mock) Diff 데이터를 입력했을 때, 위에서 정의한 ReviewPacket JSON을 뱉어내는 LLM 체인을 만드세요.

프롬프트에는 반드시 "개발자 관점이 아니라 PM/운영자 관점에서 분석하라"는 시스템 인스트럭션을 포함하세요.

Step 4: CLI 인터페이스

터미널에서 python main.py review --pr 123을 입력하면 해당 PR을 분석해 리포트를 출력하도록 만드세요.

💡 에이전트에게 추가로 줄 팁 (Context)
Idempotency (멱등성): 프로젝트 상태 동기화는 여러 번 실행해도 결과가 같아야 합니다. 중복 TODO 생성을 방지하는 로직을 신경 써주세요.

Local First: 모든 데이터(DB, Vector Store)는 ./data 폴더 안에 파일 기반으로 저장되어야 합니다. (SQLite, Chroma Persist)

Error Handling: LLM이 잘못된 JSON을 반환할 경우를 대비해 retry 로직을 포함해야 합니다.

작업을 시작해 주세요. 먼저 프로젝트 디렉토리 구조를 생성하고, models/schema.py부터 작성해 주십시오.
